<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Names List with Dropdown</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: space-between;
            padding: 20px;
        }

        .names-container {
            width: 45%;
        }

        .names-container h2 {
            margin-bottom: 10px;
        }

        .names-list {
            list-style-type: none;
            padding: 0;
            cursor: pointer;
        }

        .names-list li {
            padding: 8px;
            margin: 5px 0;
            background-color: #f0f0f0;
            border-radius: 4px;
        }

        .names-list li.selected {
            background-color: #b3d9ff;
        }

        .associated-item {
            padding: 5px;
            margin-left: 20px;
            background-color: #e0e0e0;
            border-radius: 4px;
        }

        .dropdown-container {
            width: 45%;
        }

        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
        }

    </style>
</head>
<body>

    <div class="names-container">
        <h2>Names List</h2>
        <ul class="names-list" id="namesList">
            <!-- Names will be dynamically inserted here -->
        </ul>
    </div>

    <div class="dropdown-container">
        <h2>Select from Dropdown</h2>
        <select id="nameSelect" onchange="addNameToList()">
            <option value="">-- Select an item --</option>
            <!-- Dropdown items will be dynamically inserted here -->
        </select>
    </div>

    <script>
        let selectedName = null;
        let selectedLi = null;
        const namesList = document.querySelector('.names-list');
        const nameSelect = document.getElementById('nameSelect');

        // The names list will come from here (replace with your actual data)
        const names = ["John", "Jane", "Michael", "Sarah", "David"];

        // The dropdown items collection (as per the new format)
        const dropdownItems = {
            "AppFl": {
                "value": "4",
                "description": "Appare in un Flashback"
            },
            "AppTag": {
                "value": "7",
                "description": "Appare in una taglia"
            }
        };

        // Track selected items for each name
        const nameAssociations = {
            John: [],
            Jane: [],
            Michael: [],
            Sarah: [],
            David: []
        };

        // Dynamically populate the names list on the left
        names.forEach(name => {
            const li = document.createElement('li');
            li.textContent = name;
            li.setAttribute('data-name', name);
            namesList.appendChild(li);
        });

        // Dynamically populate the dropdown items
        Object.entries(dropdownItems).forEach(([key, item]) => {
            const option = document.createElement('option');
            option.value = item.value;
            option.textContent = item.description;
            nameSelect.appendChild(option);
        });

        // Event listener for name clicks in the left list
        namesList.addEventListener('click', function(e) {
            const clickedItem = e.target;
            
            if (clickedItem.tagName.toLowerCase() === 'li' && !clickedItem.classList.contains('associated-item')) {
                document.querySelectorAll('.names-list li').forEach(li => li.classList.remove('selected'));
                clickedItem.classList.add('selected');
                
                selectedName = clickedItem.getAttribute('data-name');
                selectedLi = clickedItem;

                // Update the dropdown based on the selected name
                updateDropdown();
            }
        });

        // Event listener for removing associated items (sub-elements) on double click
        namesList.addEventListener('dblclick', function(e) {
            const clickedItem = e.target;
            
            if (clickedItem.tagName.toLowerCase() === 'li' && clickedItem.classList.contains('associated-item')) {
                clickedItem.remove();

                enableItemInDropdown(clickedItem.textContent);

                const index = nameAssociations[selectedName].indexOf(clickedItem.textContent);
                if (index > -1) {
                    nameAssociations[selectedName].splice(index, 1);
                }

                updateDropdown();
            }
        });

        function addNameToList() {
            const selectedItemValue = document.getElementById("nameSelect").value;
            const selectedItemDesc = document.getElementById("nameSelect").selectedOptions[0].textContent;

            if (selectedName && selectedItemValue) {
                const associatedLi = document.createElement("li");
                associatedLi.textContent = `${selectedItemDesc}`;
                associatedLi.classList.add("associated-item");
                
                selectedLi.appendChild(associatedLi);

                nameAssociations[selectedName].push(selectedItemDesc);

                removeItemFromDropdown(selectedItemDesc);

                document.getElementById("nameSelect").value = "";

                updateDropdown();
            } else {
                alert("Please select a name on the left and an item from the dropdown.");
            }
        }

        function removeItemFromDropdown(itemDescription) {
            const options = nameSelect.options;
            for (let i = 1; i < options.length; i++) {
                if (options[i].textContent === itemDescription) {
                    options[i].disabled = true;
                    options[i].style.color = "gray";
                    break;
                }
            }
        }

        function enableItemInDropdown(itemDescription) {
            const options = nameSelect.options;
            for (let i = 1; i < options.length; i++) {
                if (options[i].textContent === itemDescription) {
                    options[i].disabled = false;
                    options[i].style.color = "black";
                    break;
                }
            }
        }

        function updateDropdown() {
            const options = nameSelect.options;

            for (let i = 1; i < options.length; i++) {
                options[i].disabled = false;
                options[i].style.color = "black";
            }

            nameAssociations[selectedName].forEach(item => {
                for (let i = 1; i < options.length; i++) {
                    if (options[i].textContent === item) {
                        options[i].disabled = true;
                        options[i].style.color = "gray";
                    }
                }
            });
        }
    </script>

</body>
</html>
